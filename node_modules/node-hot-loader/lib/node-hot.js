#!/usr/bin/env node
"use strict";

var _yargs = _interopRequireDefault(require("yargs"));

var _path = _interopRequireDefault(require("path"));

var _fs = _interopRequireDefault(require("fs"));

var _loader = _interopRequireDefault(require("./loader"));

var _package = _interopRequireDefault(require("../package.json"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const options = {
  config: 'webpack.config.js',
  fork: false,
  logLevel: undefined
};

const params = _yargs.default.config(options).usage('Usage: $0 [args]').help('help').alias('help', 'h').alias('help', '?').version(_package.default.version).alias('version', 'v').options({
  config: {
    type: 'string',
    describe: 'Path to the webpack config file',
    defaultDescription: 'webpack.config.js',
    requiresArg: false
  },
  fork: {
    type: 'boolean',
    describe: 'Launch compiled assets in forked process',
    defaultDescription: 'false',
    requiresArg: false
  },
  logLevel: {
    type: 'string',
    describe: 'Log level related to webpack stats configuration presets names. See presets from https://webpack.js.org/configuration/stats/#stats.',
    requiresArg: false
  }
}).example('node-hot --config webpack.config.js', 'Using a specific webpack config file.').example('node-hot', 'Using default webpack config file.').example('node-hot --logLevel minimal', 'Set a specific logLevel for node-hot-loader.').showHelpOnFail(false, 'Use the --help option to get the list of available options.').check(args => {
  if (!_fs.default.existsSync(args.config)) {
    throw new Error(`Webpack config file '${args.config}' not found!`);
  }

  return true;
}).coerce('config', value => {
  if (!_path.default.isAbsolute(value)) {
    return _path.default.join(process.cwd(), value);
  }

  return value;
}).coerce('logLevel', value => {
  if (value === '') return true;
  if (value === 'true') return false;
  if (value === 'false') return false;
  return value;
}).strict().argv;

options.config = params.config;
options.fork = params.fork;
options.logLevel = params.logLevel;
(0, _loader.default)(options);